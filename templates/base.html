<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title or "Budget Buddy" }}</title>
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='images/favicon.svg') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Spending Alerts -->
    <div id="spending-alerts" class="spending-alerts">
        <!-- Alerts will be dynamically inserted here -->
    </div>

    <!-- Modern Navigation -->
    <nav class="navbar">
        <div class="container">
            <!-- Brand -->
            <a href="{{ url_for('index') }}" class="nav-brand">
                <img src="{{ url_for('static', filename='images/budget-buddy-logo.png') }}" alt="Budget Buddy">
            </a>

            <!-- Desktop Navigation -->
            <ul class="nav-menu">
                <li><a href="{{ url_for('index') }}" class="nav-link {{ 'active' if request.endpoint == 'index' }}">Add Transaction</a></li>
                <li><a href="{{ url_for('transactions') }}" class="nav-link {{ 'active' if request.endpoint == 'transactions' }}">Transactions</a></li>
                <li><a href="{{ url_for('stats') }}" class="nav-link {{ 'active' if request.endpoint == 'stats' }}">Analytics</a></li>
                <li><a href="{{ url_for('achievements') }}" class="nav-link {{ 'active' if request.endpoint == 'achievements' }}">üèÜ Achievements</a></li>
                <li><a href="{{ url_for('limits') }}" class="nav-link {{ 'active' if request.endpoint == 'limits' }}">Limits</a></li>
                <li><a href="{{ url_for('scan_receipt') }}" class="nav-link {{ 'active' if request.endpoint == 'scan_receipt' }}">Scan Receipt</a></li>
            </ul>

            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
                Menu
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="text-center">
                <p class="text-secondary">
                    ¬© 2025 Budget Buddy - Smart Expense Tracking
                </p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // Mobile Menu Toggle
        function toggleMobileMenu() {
            const menu = document.querySelector('.nav-menu');
            menu.classList.toggle('active');
        }

        // Spending Alerts System
        function fetchAlerts() {
            fetch('/get_alerts')
                .then(response => response.json())
                .then(alerts => {
                    const alertsContainer = document.getElementById('spending-alerts');
                    
                    if (alerts.length === 0) {
                        alertsContainer.classList.remove('show');
                        return;
                    }

                    alertsContainer.innerHTML = alerts.map(alert => `
                        <div class="spending-alert">
                            <div class="alert-content">
                                <div class="alert-title">Spending Alert: ${alert.category}</div>
                                <div class="alert-message">
                                    You've spent $${alert.current_spending} out of $${alert.limit} (${alert.threshold_percentage}% threshold)
                                </div>
                            </div>
                            <button class="alert-dismiss" onclick="dismissAlert('${alert.key}')">
                                √ó
                            </button>
                        </div>
                    `).join('');

                    alertsContainer.classList.add('show');
                })
                .catch(error => console.error('Error fetching alerts:', error));
        }

        function dismissAlert(alertKey) {
            fetch(`/dismiss_alert/${alertKey}`)
                .then(() => {
                    fetchAlerts();
                })
                .catch(error => console.error('Error dismissing alert:', error));
        }

        // Initialize alerts and refresh every 30 seconds
        fetchAlerts();
        setInterval(fetchAlerts, 30000);

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Add fade-in animation to cards
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('fade-in');
                }
            });
        }, observerOptions);

        document.querySelectorAll('.card, .stat-card').forEach(card => {
            observer.observe(card);
        });
    </script>

    <style>
        /* Additional styles for better UX */
        .main-content {
            min-height: calc(100vh - 200px);
            padding: var(--space-xl) 0;
        }

        .footer {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--border-primary);
            padding: var(--space-lg) 0;
            margin-top: auto;
        }

        /* Loading states */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        /* Focus styles for accessibility */
        .nav-link:focus,
        .btn:focus,
        .form-input:focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-primary);
            border-radius: var(--radius-md);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--border-secondary);
        }
    </style>
</body>
</html>
